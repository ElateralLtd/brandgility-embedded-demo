"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var ClientPostMessageAPI=function(){function t(e){var o=this;return _classCallCheck(this,t),_defineProperty(this,"eventCallbacks",new Map),_defineProperty(this,"iframeSelector",null),_defineProperty(this,"on",function(e,t){if("function"==typeof t){var r=o.eventCallbacks.get(e)||[];o.eventCallbacks.set(e,[].concat(_toConsumableArray(r),[t]))}return o}),_defineProperty(this,"emit",function(r){return function(e){var t=JSON.stringify({event:r,params:e});o.getIframeWindow().postMessage(t,"*")}}),_defineProperty(this,"handleMessageFromFrame",function(e){var t=e.data;try{var r=JSON.parse(t),n=r.event,a=r.data;o.eventCallbacks.has(n)&&o.eventCallbacks.get(n).forEach(function(e){return e(a)})}catch(e){}}),this.iframeSelector=e,window.addEventListener("message",this.handleMessageFromFrame),{on:this.on,save:this.emit("save"),destroy:this.destroy}}return _createClass(t,[{key:"getIframeWindow",value:function(){return document.querySelector(this.iframeSelector).contentWindow}},{key:"destroy",value:function(){window.removeEventListener("message",this.handleMessageFromFrame)}}]),t}(),_default=ClientPostMessageAPI;exports.default=_default;
